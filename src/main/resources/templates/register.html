<!doctype html>
<html lang="en" xmlns:th="http://www.thymleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Create New Account</title>
  </head>
  <body>
    <h1>Register</h1>

    <form id="register-form">
      <label for="username">Username:</label>
      <input type="text" id="username" name="username" required />
      <br />

      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required />
      <br />

      <label for="password">Password:</label>
      <input type="password" id="password" name="password" required />
      <br />

      <button type="submit">Register</button>
    </form>

    <p>Already have an account? <a th:href="@{/login}">Login here</a>.</p>

    <p id="success-message" class="success-message" style="display: none"></p>
    <p id="error-message" class="error-message" style="display: none"></p>

    <script>
      document
        .getElementById("register-form")
        .addEventListener("submit", async function (event) {
          event.preventDefault(); // Prevent the default form submission

          // Clear previous messages
          const successMessage = document.getElementById("success-message");
          const errorMessage = document.getElementById("error-message");
          successMessage.style.display = "none";
          errorMessage.style.display = "none";

          // Get form data
          const username = document.getElementById("username").value;
          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          try {
            // Send POST request to the server
            const response = await fetch("/api/auth/register", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ username, email, password }),
            });

            if (response.ok) {
              const result = await response.text();
              successMessage.textContent =
                result || "Registration successful! Please log in.";
              successMessage.style.display = "block";
            } else {
              const error = await response.text();
              errorMessage.textContent =
                error || "Registration failed. Please try again.";
              errorMessage.style.display = "block";
            }
          } catch (err) {
            errorMessage.textContent =
              "An unexpected error occurred. Please try again.";
            errorMessage.style.display = "block";
          }
        });
    </script>
  </body>
</html>
